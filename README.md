# Библиотека matrix_oop

## Обзор

Библиотека `matrix_oop` — это реализация класса для работы с матрицами на C++, разработанная для имитации операций с матрицами, аналогичных функциональности стандартной библиотеки C++. Класс `S21Matrix` предоставляет методы для создания, манипуляции и вычислений с матрицами, включая суммирование, вычитание, умножение, транспонирование, вычисление определителя, алгебраических дополнений и обратной матрицы. Библиотека ориентирована на объектно-ориентированный подход и обработку исключений для обеспечения надежности.

Проект структурирован для кроссплатформенной совместимости (Linux и macOS) с использованием системы сборки через `Makefile` для компиляции, тестирования, анализа покрытия кода, проверки памяти и соблюдения стиля кодирования.

## Особенности

- **S21Matrix**: Класс для представления матриц, поддерживающий:
  - Конструкторы: По умолчанию, с размерами, копирования и перемещения.
  - Операции: Суммирование (`SumMatrix`, `+`), вычитание (`SubMatrix`, `-`), умножение на число (`MulNumber`, `*`), умножение матриц (`MulMatrix`, `*`), транспонирование (`Transpose`), вычисление алгебраических дополнений (`CalcComplements`), определителя (`Determinant`) и обратной матрицы (`InverseMatrix`).
  - Сравнение: `EqMatrix` и оператор `==`.
  - Доступ к элементам: Оператор `()` с проверкой границ.
  - Мутаторы: `SetRows`, `SetCols` для изменения размеров матрицы.
  - Обработка исключений: Для некорректных размеров, неинициализированных матриц, сингулярных матриц и т.д.
- **Кроссплатформенность**: Совместимость с Linux (g++) и macOS (clang++).
- **Тестирование**: Полный набор модульных тестов с использованием Google Test, охватывающих операции, исключения и пограничные случаи.
- **Анализ покрытия кода**: Поддержка отчетов о покрытии с помощью `lcov` (Linux) или `llvm-cov` (macOS).
- **Безопасность памяти**: Поддержка AddressSanitizer (ASan) и Valgrind (Linux) для обнаружения утечек памяти.
- **Стиль кодирования**: Соблюдение Google C++ Style Guide с использованием `clang-format`.
- **Дополнительно**: Проверка кода с помощью `cppcheck`.

## Структура проекта

```
MatrixPlus/
├
│   ├── s21_matrix_oop.h       # Заголовочный файл класса S21Matrix
│   ├── s21_matrix_oop.cpp     # Реализация методов класса
│   └── Makefile               # Система сборки для компиляции, тестирования и анализа
└── tests/
    └── s21_matrix_test.cpp    # Модульные тесты для класса S21Matrix
```

## Требования

- **Компилятор C++**:
  - Linux: `g++` (с поддержкой C++20)
  - macOS: `clang++` с `libc++` (с поддержкой C++20)
- **Google Test**: Требуется для запуска модульных тестов.
  - Linux: Установите через менеджер пакетов (например, `libgtest-dev`) или убедитесь, что `pkg-config` может найти библиотеку.
  - macOS: Установите через Homebrew (`brew install googletest`).
- **Инструменты для покрытия кода**:
  - Linux: `lcov` и `genhtml` для создания отчетов о покрытии.
  - macOS: `llvm-profdata` и `llvm-cov` (включены в Xcode).
- **Valgrind** (только для Linux): Для обнаружения утечек памяти.
- **clang-format**: Для соблюдения стиля кодирования (Google style).
- **cppcheck**: Для статического анализа кода.

## Сборка и запуск

`Makefile` предоставляет несколько целей для сборки, тестирования и анализа проекта. Ниже приведены основные команды:

- **Сборка библиотеки**:

  ```bash
  make all
  ```

  Создает статическую библиотеку `s21_matrix_oop.a`.

- **Сборка и запуск тестов**:

  ```bash
  make test
  ```

  Компилирует и запускает модульные тесты с использованием Google Test.

- **Создание отчета о покрытии кода**:

  ```bash
  make gcov_report
  ```

  Запускает тесты и создает HTML-отчет о покрытии в каталоге `gcov_report/`. Открывает отчет в браузере.

- **Запуск AddressSanitizer**:

  ```bash
  make test_asan
  ```

  Компилирует и запускает тесты с AddressSanitizer для обнаружения проблем с памятью.

- **Запуск Valgrind (только Linux)**:

  ```bash
  make test_valgrind
  ```

  Запускает тесты с инструментом memcheck Valgrind для обнаружения утечек памяти. Логи сохраняются в `logs/valgrind_log.txt`.

- **Проверка стиля кодирования**:

  ```bash
  make test_style
  ```

  Проверяет, что все исходные файлы соответствуют Google C++ Style Guide.

- **Применение стиля кодирования**:

  ```bash
  make style
  ```

  Форматирует все исходные файлы с помощью `clang-format` в соответствии с Google style.

- **Статический анализ кода**:

  ```bash
  make test_cppcheck
  ```

  Запускает `cppcheck` для обнаружения потенциальных ошибок.

- **Очистка артефактов сборки**:

  ```bash
  make clean
  ```

  Удаляет объектные файлы, исполняемые файлы и данные покрытия.

- **Очистка файлов покрытия**:

  ```bash
  make clean_coverage
  ```

  Удаляет только файлы, связанные с покрытием кода.

## Пример использования

Ниже приведен пример использования класса `S21Matrix`:

```cpp
#include "s21_matrix_oop.h"
#include <iostream>

int main() {
    //Создание матрицы
    S21Matrix matrix(2, 2);
    matrix(0, 0) = 1.0;
    matrix(0, 1) = 2.0;
    matrix(1, 0) = 3.0;
    matrix(1, 1) = 4.0;

    //Вычисление определителя
    double det = matrix.Determinant();
    std::cout << "Determinant: " << det << std::endl; 

    //Транспонирование
    S21Matrix transposed = matrix.Transpose();
    std::cout << "Transposed (0,1): " << transposed(0, 1) << std::endl;

    //Обратная матрица
    S21Matrix inverse = matrix.InverseMatrix();
    std::cout << "Inverse (0,0): " << inverse(0, 0) << std::endl;

    //Умножение на число
    matrix.MulNumber(2.0);
    std::cout << "Multiplied by 2 (1,1): " << matrix(1, 1) << std::endl;

    return 0;
}
```

## Детали реализации

- **S21Matrix**:
  - Представляет матрицу как массив указателей на строки (динамическая аллокация).
  - Поддерживает копирование и перемещение для эффективного управления ресурсами.
  - Методы выбрасывают исключения (`std::invalid_argument`, `std::runtime_error`, `std::out_of_range`) для некорректных операций (например, несовместимые размеры, нулевой определитель).
  - Вычисление определителя реализовано рекурсивно с использованием миноров.
  - Алгебраические дополнения и обратная матрица основаны на транспонировании и делении на определитель.
- **Управление памятью**:
  - Ручное управление памятью с использованием `new`/`delete` для предотвращения утечек, проверяемое ASan и Valgrind.
  - Мутаторы `SetRows`/`SetCols` динамически изменяют размер с сохранением данных.

## Тестирование

Каталог `tests/` содержит модульные тесты для `S21Matrix`, охватывающие:

- Конструкторы и деструкторы.
- Основные операции (суммирование, вычитание, умножение, транспонирование).
- Вычисления (определитель, дополнения, обратная матрица).
- Сравнение и доступ к элементам.
- Исключения и пограничные случаи (пустые матрицы, некорректные размеры, NaN/Infinity).

Запустите `make test` для выполнения всех тестов. Используйте `make gcov_report` для проверки высокого уровня покрытия тестами.

## Участие в разработке

Чтобы внести вклад:

1. Сделайте форк репозитория.
2. Создайте ветку для новой функциональности (`git checkout -b feature-name`).
3. Убедитесь, что код соответствует Google C++ Style Guide (`make style`).
4. Добавьте или обновите модульные тесты в каталоге `tests/`.
5. Проверьте безопасность памяти (`make test_asan` или `make test_valgrind`).
6. Отправьте pull request с подробным описанием изменений.
